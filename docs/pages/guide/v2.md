---
footer: false
---

<script setup>
  import useNpmVersion from '@theme/hooks/useNpmVersion';
  import { onMounted, computed, ref } from 'vue';
  import axios from 'axios';

  const { load: loadVersion, version } = useNpmVersion();

  onMounted(() => {
    loadVersion();
  });

  const config = {
    dev: {
      api: 'https://dev.hasura.agiodigital.com/v1/graphql',
      widget: 'https://develop.agiodigital.com/#/direct/kyc-iframe',
    },
    prod: {
      api: 'https://hasura.agiodigital.com/v1/graphql',
      widget: 'https://app.agiodigital.com/#/direct/kyc-iframe',
    },
  }

  const initToken = ref('');
  const lang = ref(null);
  const step = ref(null); 
  const kyb = ref(false);
  const useAlternativeKycLevel = ref(false);
  const cleanWallet = ref(true);
  const walletAddress = ref('YOUR_WALLET_ADDRESS');
  const walletAddressDisabled = ref(false);
  const paymentsDisabled = ref(false);
  const kytDisabled = ref(false);
  const kycDisabled = ref(false);
  const debug = ref(false);
  const currency = ref('USD');
  const amount = ref(0);
  const mutationVariables = {
    apiToken: "a66bdfbe-ba27-4741-9365-3ee7b3b5c0e2",
    externalUserId: "john_doe_01",
    amount: 100,
    ttl: 5400,
    externalUserFirstName: "John",
    externalUserLastName: "Doe",
    externalUserEmail: "example@email.com",
    currency: "BSD",
  }

  const getInitToken = () => {
    console.warn('[getInitToken] âš ï¸WARNINGâš ï¸: This mutation should be called from a backend service. This is for demo purposes only.');
    axios.post(config.dev.api, {
  query: `
    mutation {
      token: generateKycSdkInitToken(input: {
        apiToken: "a66bdfbe-ba27-4741-9365-3ee7b3b5c0e2",
        externalUserId: "example_user_01",
        amount: 100,
        ttl: 5400,
        externalUserFirstName: "Christian",
        externalUserLastName: "Wijnia",
        externalUserEmail: "chris@agiodigital.com",
        currency: "BSD",
      })
    }
  `
}).then(response => {
  const token = response.data.data.token;
  initToken.value = token;
}).catch(error => {
  console.error("Error:", error);
});
  }

  getInitToken();

  const iframeSrc = computed(() => {
    if (!initToken.value) {
      return '';
    }
  return `${config.dev.widget}?` +
    `token=${initToken.value}&` +
    (lang.value ? `lang=${lang.value}&` : '') +
    (step.value ? `step=${step.value}&` : '') +
    `kyb=${kyb.value}&` +
    `useAlternativeKycLevel=${useAlternativeKycLevel.value}&` +
    `cleanWallet=${cleanWallet.value}&` +
    `walletAddress=${walletAddress.value}&` +
    `walletAddressDisabled=${walletAddressDisabled.value}&` +
    `paymentsDisabled=${paymentsDisabled.value}&` +
    `kytDisabled=${kytDisabled.value}&` +
    `kycDisabled=${kycDisabled.value}&` +
    `debug=${debug.value}&` +
    `currency=${currency.value}&` +
    `amount=${amount.value}`;
  });

const queryParamsObject = computed(() => (iframeSrc.value?.split("?")?.[1]?.split("&") || []).reduce((acc, curr) => {
  const [key, value] = curr.split("=");
  acc[key] = value;
  return acc;
}, {}));
</script>

# Agio SDK - v2.x (beta) - Iframe Widget Integration Guide for Host Applications

Welcome to the iFrame Widget Integration Guide. This document will provide you with a comprehensive overview of integrating our widget seamlessly into your application. Leveraging URL query parameters, you can customize the widget to suit your application's needs.

## Table of Contents
1. [High-Level Overview](#high-level-overview)
2. [Token Flow Chart](#token-flow-chart)
3. [Available Query Parameters](#available-query-parameters)
4. [Integration Example](#integration-example)
4. [Live Example](#live-example)
5. [Handling Errors](#handling-errors)
6. [Customizing the Widget](#customizing-the-widget)
7. [Further Assistance](#need-further-assistance)

## High-Level Overview
The integration process consists of embedding the iFrame widget into your application. This can be done by using an `<iframe>` tag with various query parameters that allow customization. The key aspect is the `token` parameter, which authorizes access to the widget functionalities.

## Token Flow Chart
```ascii
+------------+     +------------+     +------------+
| Your App   |     | Backend    |     | iFrame     |
|            |     | Service    |     | Widget     |
+------------+     +------------+     +------------+
       | Generate           | Generate          |
       | Init Request       | Init Token        |
       |-------------------->|                   |
       |                    |------------------->|
       |                    | Return Init Token |
       |<-------------------|                   |
       | Embed Widget with  |                   |
       | Received Token     |                   |
       |-------------------->|                   |
```

# Getting the Init Token

To get the initiation token for the KYC SDK, you need to execute the `generateKycSdkInitToken` GraphQL mutation.

**Note: This mutation should be called from a backend service.**

Always call this mutation from a backend service. Never call this mutation from the frontend. If you call this mutation from the frontend, you will expose your API token to the public. This will allow anyone to generate initiation tokens for your API token.

### Base URL:

- **production:** `https://hasura.agiodigital.com/v1/graphql`
- **development:** `https://dev.hasura.agiodigital.com/v1/graphql`

## GraphQL Mutation:

```graphql
mutation {
  generateKycSdkInitToken(
    input: {
      apiToken: "a66bdfbe-ba27-4741-9365-3ee7b3b5c0e2"
      externalUserId: "john_doe_01"
      amount: 100
      ttl: 5400
      externalUserFirstName: "John"
      externalUserLastName: "Doe"
      externalUserEmail: "example@email.com"
      currency: "BSD"
    }
  )
}
```

## Using CURL:

For **Production**:

```bash
curl -X POST \
     -H "Content-Type: application/json" \
     --data '{"query":"mutation { generateKycSdkInitToken(input: { apiToken: \"a66bdfbe-ba27-4741-9365-3ee7b3b5c0e2\", externalUserId: \"john_doe_01\", amount: 100, ttl: 5400, externalUserFirstName: \"John\", externalUserLastName: \"Doe\", externalUserEmail: \"example@email.com\", currency: \"BSD\", }) }"}' \
     https://hasura.agiodigital.com/v1/graphql
```

For **Development**:

```bash
curl -X POST \
     -H "Content-Type: application/json" \
     --data '{"query":"mutation { generateKycSdkInitToken(input: { apiToken: \"a66bdfbe-ba27-4741-9365-3ee7b3b5c0e2\", externalUserId: \"john_doe_01\", amount: 100, ttl: 5400, externalUserFirstName: \"John\", externalUserLastName: \"Doe\", externalUserEmail: \"example@email.com\", currency: \"BSD\", }) }"}' \
     https://dev.hasura.agiodigital.com/v1/graphql
```

## Using Axios:

```ts
import axios from "axios";

const BASE_URL="https://hasura.agiodigital.com/v1/graphql"; 
// For development use:
// BASE_URL="https://dev.hasura.agiodigital.com/v1/graphql";

axios
  .post(BASE_URL, {
    query: `
    mutation {
      generateKycSdkInitToken(input: {
        apiToken: "a66bdfbe-ba27-4741-9365-3ee7b3b5c0e2",
        externalUserId: "john_doe_01",
        amount: 100,
        ttl: 5400,
        externalUserFirstName: "John",
        externalUserLastName: "Doe",
        externalUserEmail: "example@email.com",
        currency: "USD",
      })
    }
  `
  })
  .then((response) => {
    console.log(response.data);
  })
  .catch((error) => {
    console.error("Error:", error);
  });
```

## Available Query Parameters

### `token`

- **Type**: String
- **Description**: Your API token to authorize access to the widget.
- **Constraints**:
  - Minimum length of 1.
  - Must be a valid JWT format with a valid `sub` claim.
- **Default**: Derived from `sdkStore.initToken`.
- **Errors**: `invalid_token_message`

### `lang`

- **Type**: String (optional, nullable)
- **Description**: Specifies the language of the widget interface.
- **Accepted values**:
  - `pt`, `pt-br`, `br` â†’ Transforms to `pt-BR`
  - `us`, `usa`, `gb`, `en-gb` â†’ Transforms to `en`
  - Values must be within the supported language codes.
- **Errors**: `invalid_lang_message`

### `step`

- **Type**: String (optional, nullable)
- **Description**: Determines the step or phase the widget should load.

### `kyb`

- **Type**: Boolean (optional, nullable)
- **Description**: Enables or disables the "Know Your Business" feature.
- **Default**: `false`

### `useAlternativeKycLevel`

- **Type**: Boolean (optional, nullable)
- **Description**: Switch between primary and alternative KYC levels.
- **Default**: `false`

### `cleanWallet`

- **Type**: Boolean (optional, nullable)
- **Description**: Option to sanitize or clear wallet data.
- **Default**: `false`

### `walletAddress`

- **Type**: String (optional, nullable)
- **Description**: Specify a default wallet address.
- **Default**: Empty string.

### `walletAddressDisabled`

- **Type**: Boolean (optional, nullable)
- **Description**: Disables the modification of the wallet address.
- **Default**: `false`

### `paymentsDisabled`

- **Type**: Boolean (optional, nullable)
- **Description**: Disables the payment functionalities.
- **Default**: `true`

### `kytDisabled`

- **Type**: Boolean (optional, nullable)
- **Description**: Disables the "Know Your Transaction" feature.
- **Default**: `false`

### `kycDisabled`

- **Type**: Boolean (optional, nullable)
- **Description**: Disables the "Know Your Customer" feature.
- **Default**: `false`

### `debug`

- **Type**: Boolean (optional, nullable)
- **Description**: Activates debug mode to assist in troubleshooting.
- **Default**: `false`

### `currency`

- **Type**: String (optional, nullable)
- **Description**: Specifies the default currency to be used.
- **Accepted values**: Must be among the supported currencies.
- **Transform**: Values are converted to uppercase.
- **Default**: `USD`
- **Errors**: `not_supported`

### `amount`

- **Type**: Number (optional, nullable)
- **Description**: Specifies the default amount.
- **Constraints**: Must be non-negative.
- **Default**: `0`

## Integration Example

```html
<iframe
  src="https://develop.agiodigital.com/widget?token=INIT_TOKEN&lang=en&step=1&kyb=true&useAlternativeKycLevel=false&cleanWallet=true&walletAddress=YOUR_WALLET_ADDRESS&walletAddressDisabled=false&paymentsDisabled=true&kytDisabled=false&kycDisabled=false&debug=true&currency=USD&amount=1000"
  height="600"
  frameborder="0"
  style="width: 100%;"
></iframe>
```

## Live Example

<button class="button" @click="getInitToken">ðŸ”„ Refresh Init Token</button>

<iframe v-if="iframeSrc" :key=iframeSrc :src="iframeSrc" height="600" frameborder="0" style="width: 100%; margin-bottom: 1rem; 1px solid var(--vt-c-divider-light); border-radius: 0.5rem; overflow: hidden;"></iframe>

<a class="button" :href="iframeSrc" target="_blank" style="margin-bottom: 1rem">ðŸ”— Open in new tab</a>
<small style="line-height: 1.1; display: block; word-break: break-all;"><a :href="iframeSrc" target="_blank">{{iframeSrc}}</a></small>

### Query Parameters
<div class="language-json vp-adaptive-theme">
  <pre class="shiki"><code>{{queryParamsObject}}</code></pre>
</div>

## Notes:

1. Replace `INIT_TOKEN` and `YOUR_WALLET_ADDRESS` with appropriate values.
2. You can adjust the `width` and `height` attributes of the `<iframe>` to better fit the widget within your application.
3. Always ensure that the `token` is securely generated and passed to the widget to prevent unauthorized access.
4. You can remove or add any optional parameters based on your application's requirements.

## Handling Errors

When a parameter is not valid or encounters an issue, the widget will handle errors internally and display the corresponding message, e.g., `invalid_token_message` or `invalid_lang_message`. Ensure your backend handles token generation and validation appropriately to prevent errors when accessing the widget.

## Customizing the Widget

URL query parameters are a convenient way to customize the behavior and appearance of the widget based on your application's needs. By understanding and using the available parameters, you can provide a seamless experience for your users.

---

Remember always to test the integration in a safe and secure environment before deploying it to production to ensure there are no unexpected behaviors or security vulnerabilities.

## Need Further Assistance?

For any questions or concerns, please reach out to our support team.

---

Adjust the text as needed based on the specific requirements and behaviors of your widget.
